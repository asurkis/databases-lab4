# Лабораторная работа № 4 по предмету &laquo;Информационные системы и базы данных&raquo;

Выполнил студент Суркис Антон Игоревич<br>
Группа P33113<br>
Преподаватель: Николаев Владимир Вячеславович

## Цель работы
Для отношений, полученных при построении предметной области из
лабораторной работы №1, выполните следующие действия:
- опишите функциональные зависимости для отношений полученной схемы (минимальное множество);
- приведите отношения в 3NF (как минимум). Постройте схему на основе полученных отношений;
- опишите изменения в функциональных зависимостях, произошедшие после преобразования в 3NF;
- преобразуйте отношения в BCNF. Докажите, что полученные отношения представлены в BCNF;
- какие денормализации будут полезны для вашей схемы? Приведите подробное описание;

## Выполнение

### Описание предметной области, по которой должна быть построена доменная модель:
Приближался миг, когда им впервые за все время полета предстояло распрощаться с Солнцем. Пусть побледневшее и маленькое, оно неизменно светило кораблю все пять месяцев с тех пор, как он покинул Землю. Но теперь траектория корабля уходила в тень Юпитера, и скоро перед ним должна была открыться ночная сторона планеты.

### Оригинальные связи из первой лабораторной:
#### ННФ:
![](./basic.svg)

#### НФ &geq; 1:
![](./original.svg)

### Функциональные зависимости оригинальной схемы:
- `Body.Id` => `Body.Name`
- `Position.Id` => `Position.CoordX`
- `Position.Id` => `Position.CoordY`
- `Position.Id` => `Position.CoordZ`
- `Position.Id` => `Position.Time`
- `Lighting.From`, `Lighting.To` => `Lighting.Intensity`

Эта схема уже приведена к BCNF:
- Первая нормальная форма:
    - На пересечении строки и столбца таблицы только одно значение.
- Вторая нормальная форма:
    - Все атрибуты отношений `Star` (нет атрибутов), `Body`, `TrajectoryElement`, `Position` в полной функциональной зависимости от первичных ключей, состоящих из одного элемента каждый.
    - Атрибуты отношения `Lighting` в зависимости от первичного ключа (`Lighting.From`, `Lighting.To`),
        но не от каждого из элементов по отдельности: свет одной звезды имеет разную интенсивность
        в разное время и в разных точках, точно также как свет в одной точке от разных звезд.
- Третья нормальная форма и нормальная форма Бойса-Кодда:
    - Нет зависимостей атрибутов от атрибутов, не являющихся первичными ключами.

### Денормализации:
![](./denormalized.svg)

Поскольку в большинстве случаев полезная информация извлекается из нескольких таблиц,
а не одной, например, нам интересна траектория конкретного тела, а не список всех позиций
в пространстве-времени всех тел, то можно создавать таблицы со всей необходимой информацией сразу.

## Вывод:
Нормализация отношений позволяет поддерживать ограничения целостности при
операциях удаления и вставки.
Например, в данном варианте &mdash; поддерживать одно и то же имя астрономического тела
во всех точках его траектории.

В некоторых случаях бывает полезна денормализация, например в случае,
если по смыслу две таблицы, ссылающиеся друг на друга,
почти всегда должны быть соединены в выборке,
например, положение в пространстве-времени имеет смысл только
если это положение какого-то тела.
Тогда может иметь смысл объединение этих таблиц не на уровне запросов,
а на уровне хранилища.

Но в таком случае придется отдельно поддерживать ограничения целостности данных,
например, обновлять множество значений в двух таблицах при уточнении величины светимости
звезды, наблюдаемой из определенной точки в определенное время,
в то время как в нормализованной форме для этого достаточно поменять одно значение в одной таблице.

Одним из методов поддержания целостности в денормализованных таблицах являются
транзакции (хотя это не единственное их назначение) &mdash;
можно затребовать, чтобы обновление производилось только по всем данным
(например, имя звезды и в таблице траекторий и в таблице освещенности),
или не производилось вовсе.
Но это все равно требует усложнения запросов и их выполнения.

Стоит отметить, что можно получить денормализованные представления вместо таблиц,
тогда при записи данных в нормализованные таблицы ограничения целостности все еще будут работать,
а при чтении можно будет получить все удобства чтения из объединенной таблицы.
Но материализованное представление может сильно повлиять на производительность
и синхронизацию,
а нематериализованное является всего лишь упрощением написания запроса,
и никак не влияет на сам факт объединения таблиц в запросе
(что, опять же, влияет на производительность).
